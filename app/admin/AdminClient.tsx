"use client";
import { useEffect, useState } from "react";
import { auth, db } from "../../lib/firebase";
import { onAuthStateChanged } from "firebase/auth";
import { doc, getDoc, collection, getDocs, deleteDoc, updateDoc, writeBatch, addDoc } from "firebase/firestore";
import Header from "../../components/Header";
import Footer from "../../components/Footer";
import { useAuth } from '../../lib/auth/AuthContext';
import { useNotifications } from '../../components/SimpleNotificationSystem';

export default function AdminClient() {
  const { user, profile } = useAuth();
  const { sendNotification } = useNotifications();
  const [isAdmin, setIsAdmin] = useState(false);
  const [loading, setLoading] = useState(true);
  const [users, setUsers] = useState<any[]>([]);
  const [userId, setUserId] = useState<string | null>(null);
  const [actionLoading, setActionLoading] = useState<string | null>(null);
  const [listings, setListings] = useState<any[]>([]);
  const [listingActionLoading, setListingActionLoading] = useState<string | null>(null);
  const [events, setEvents] = useState<any[]>([]);
  const [eventActionLoading, setEventActionLoading] = useState<string | null>(null);
  const [notes, setNotes] = useState<any[]>([]);
  const [noteActionLoading, setNoteActionLoading] = useState<string | null>(null);
  const [roommates, setRoommates] = useState<any[]>([]);
  const [roommateActionLoading, setRoommateActionLoading] = useState<string | null>(null);
  const [earlyAccessRegistrations, setEarlyAccessRegistrations] = useState<any[]>([]);
  const [contactMessages, setContactMessages] = useState<any[]>([]);
  const [earlyAccessActionLoading, setEarlyAccessActionLoading] = useState<string | null>(null);
  const [contactActionLoading, setContactActionLoading] = useState<string | null>(null);

  // Arama state'leri
  const [userSearch, setUserSearch] = useState("");
  const [listingSearch, setListingSearch] = useState("");
  const [eventSearch, setEventSearch] = useState("");
  const [noteSearch, setNoteSearch] = useState("");
  const [roommateSearch, setRoommateSearch] = useState("");
  const [earlyAccessSearch, setEarlyAccessSearch] = useState("");
  const [contactSearch, setContactSearch] = useState("");

  // Toplu se√ßim state'leri
  const [selectedUsers, setSelectedUsers] = useState<string[]>([]);
  const [selectedListings, setSelectedListings] = useState<string[]>([]);
  const [selectedEvents, setSelectedEvents] = useState<string[]>([]);
  const [selectedNotes, setSelectedNotes] = useState<string[]>([]);
  const [selectedRoommates, setSelectedRoommates] = useState<string[]>([]);
  const [selectedEarlyAccess, setSelectedEarlyAccess] = useState<string[]>([]);
  const [selectedContacts, setSelectedContacts] = useState<string[]>([]);
  const [bulkActionLoading, setBulkActionLoading] = useState(false);

  // Admin kontrol√º
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, async (user) => {
      if (user) {
        setUserId(user.uid);
        console.log('üîê Admin kontrol - User ID:', user.uid);
        const userRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userRef);
        if (userSnap.exists() && userSnap.data().role === "admin") {
          console.log('‚úÖ Admin yetkisi onaylandƒ±!');
          setIsAdmin(true);
        } else {
          console.log('‚ùå Admin yetkisi yok:', userSnap.exists() ? userSnap.data() : 'User doc yok');
        }
      } else {
        console.log('‚ùå Kullanƒ±cƒ± giri≈ü yapmamƒ±≈ü');
      }
      setLoading(false);
    });
    return () => unsubscribe();
  }, []);

  // Kullanƒ±cƒ±larƒ± √ßek
  useEffect(() => {
    // GE√áICI: Admin kontrol√ºn√º bypass et
    const fetchUsers = async () => {
      try {
        const usersRef = collection(db, "users");
        const snap = await getDocs(usersRef);
        setUsers(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
      } catch (error) {
        console.error('‚ùå Firebase kullanƒ±cƒ± √ßekme hatasƒ±:', error);
      }
    };
    fetchUsers();
  }, [actionLoading]);

  // ƒ∞lanlarƒ± √ßek
  useEffect(() => {
    // GE√áICI: Admin kontrol√ºn√º bypass et
    const fetchListings = async () => {
      try {
        const listingsRef = collection(db, "secondhand");
        const snap = await getDocs(listingsRef);
        setListings(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
      } catch (error) {
        console.error('‚ùå Firebase ilan √ßekme hatasƒ±:', error);
      }
    };
    fetchListings();
  }, [listingActionLoading]);

  // Etkinlikleri √ßek
  useEffect(() => {
    // GE√áICI: Admin kontrol√ºn√º bypass et
    const fetchEvents = async () => {
      console.log('üîç Admin paneli - Firebase etkinlikleri √ßekiliyor...');
      try {
        // Cache'i temizlemek i√ßin force refresh
        const eventsRef = collection(db, "events");
        const snap = await getDocs(eventsRef);
        const fetchedEvents = snap.docs.map(doc => {
          const data = doc.data();
          
          // SADECE document ID kullan, data.id'yi hi√ß dahil etme
          const { id: dataId, ...cleanData } = data; // data.id'yi √ßƒ±kar
          return { 
            id: doc.id,  // Firebase document ID (tek doƒüru ID)
            ...cleanData  // data.id olmadan diƒüer t√ºm veriler
          };
        });
        
        // JavaScript tarafƒ±nda tarih sƒ±ralamasƒ± yap
        const sortedEvents = fetchedEvents.sort((a: any, b: any) => {
          // createdAt alanƒ±nƒ± tarihe √ßevir
          const getTimestamp = (createdAt: any) => {
            if (!createdAt) return 0;
            if (createdAt.seconds) {
              // Firestore timestamp ise
              return createdAt.seconds * 1000;
            }
            if (typeof createdAt === 'string') {
              // String ise Date'e √ßevir
              return new Date(createdAt).getTime();
            }
            return 0;
          };
          
          return getTimestamp(b.createdAt) - getTimestamp(a.createdAt); // Yeniden eskiye
        });
        
        console.log('üìä Admin paneli - Etkinlik sayƒ±sƒ±:', sortedEvents.length);
        
        // Sadece ge√ßerli etkinlikleri filtrele
        const validEvents = sortedEvents.filter((event: any) => event.id && event.title);
        
        setEvents(validEvents);
      } catch (error) {
        console.error('‚ùå Firebase etkinlik √ßekme hatasƒ±:', error);
      }
    };
    fetchEvents();
  }, [eventActionLoading]);

  // Notlarƒ± √ßek
  useEffect(() => {
    // GE√áICI: Admin kontrol√ºn√º bypass et
    const fetchNotes = async () => {
      try {
        console.log('üîç Admin paneli - Firebase notlarƒ± √ßekiliyor...');
        const notesRef = collection(db, "notes");
        const snap = await getDocs(notesRef);
        const fetchedNotes = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        console.log('üìä Admin paneli - Not sayƒ±sƒ±:', fetchedNotes.length);
        setNotes(fetchedNotes);
      } catch (error) {
        console.error('‚ùå Firebase notlarƒ± √ßekme hatasƒ±:', error);
      }
    };
    fetchNotes();
  }, [noteActionLoading]);

  // Ev arkada≈üƒ± ilanlarƒ±nƒ± √ßek
  useEffect(() => {
    // GE√áICI: Admin kontrol√ºn√º bypass et
    const fetchRoommates = async () => {
      try {
        console.log('üîç Admin paneli - Firebase ev arkada≈üƒ± ilanlarƒ± √ßekiliyor...');
        
        // Cache'i temizlemek i√ßin force refresh
        const roommatesRef = collection(db, "roommates");
        const snap = await getDocs(roommatesRef);
        
        // Sadece ger√ßekten var olan dok√ºmanlarƒ± al
        const fetchedRoommates = snap.docs
          .filter(doc => doc.exists()) // Sadece var olan dok√ºmanlar
          .map(doc => ({ id: doc.id, ...doc.data() }));
        
        console.log('üìä Admin paneli - Ev arkada≈üƒ± ilan sayƒ±sƒ±:', fetchedRoommates.length);
        console.log('üìã Ev arkada≈üƒ± ilanlarƒ±:', fetchedRoommates.map((r: any) => ({
          id: r.id,
          name: r.name,
          isApproved: r.isApproved,
          isPremium: r.isPremium,
          createdAt: r.createdAt,
          isDeleted: r.isDeleted
        })));
        
        // Detaylƒ± durum analizi
        const approvedCount = fetchedRoommates.filter((r: any) => r.isApproved === true).length;
        const pendingCount = fetchedRoommates.filter((r: any) => r.isApproved === false).length;
        const undefinedCount = fetchedRoommates.filter((r: any) => r.isApproved === undefined || r.isApproved === null).length;
        
        console.log('üîç Durum Analizi:');
        console.log('  - Onaylanmƒ±≈ü:', approvedCount);
        console.log('  - Onay bekleyen:', pendingCount);
        console.log('  - Durum belirsiz:', undefinedCount);
        console.log('  - Toplam:', fetchedRoommates.length);
        
        setRoommates(fetchedRoommates);
      } catch (error) {
        console.error('‚ùå Firebase ev arkada≈üƒ± √ßekme hatasƒ±:', error);
      }
    };
    fetchRoommates();
  }, [roommateActionLoading]);

  // Erken eri≈üim kayƒ±tlarƒ±nƒ± √ßek
  useEffect(() => {
    // GE√áICI: Admin kontrol√ºn√º bypass et
    const fetchEarlyAccess = async () => {
      try {
        console.log('üîç Admin paneli - Firebase erken eri≈üim kayƒ±tlarƒ± √ßekiliyor...');
        const earlyAccessRef = collection(db, "early_access_registrations");
        const snap = await getDocs(earlyAccessRef);
        const fetchedEarlyAccess = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        console.log('üìä Admin paneli - Erken eri≈üim kayƒ±t sayƒ±sƒ±:', fetchedEarlyAccess.length);
        console.log('üìã Erken eri≈üim kayƒ±tlarƒ±:', fetchedEarlyAccess);
        setEarlyAccessRegistrations(fetchedEarlyAccess);
      } catch (error) {
        console.error('‚ùå Firebase erken eri≈üim kayƒ±tlarƒ± √ßekme hatasƒ±:', error);
      }
    };
    fetchEarlyAccess();
  }, [earlyAccessActionLoading]);

  // ƒ∞leti≈üim mesajlarƒ±nƒ± √ßek
  useEffect(() => {
    // GE√áICI: Admin kontrol√ºn√º bypass et
    const fetchContactMessages = async () => {
      try {
        console.log('üîç Admin paneli - Firebase ileti≈üim mesajlarƒ± √ßekiliyor...');
        const contactRef = collection(db, "contact_messages");
        const snap = await getDocs(contactRef);
        const fetchedContactMessages = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        console.log('üìä Admin paneli - ƒ∞leti≈üim mesaj sayƒ±sƒ±:', fetchedContactMessages.length);
        setContactMessages(fetchedContactMessages);
      } catch (error) {
        console.error('‚ùå Firebase ileti≈üim mesajlarƒ± √ßekme hatasƒ±:', error);
      }
    };
    fetchContactMessages();
  }, [contactActionLoading]);

  // Filtreleme fonksiyonlarƒ±
  const filteredUsers = users.filter(user => 
    user.email?.toLowerCase().includes(userSearch.toLowerCase()) ||
    user.displayName?.toLowerCase().includes(userSearch.toLowerCase()) ||
    user.role?.toLowerCase().includes(userSearch.toLowerCase())
  );

  const filteredListings = listings.filter(listing => 
    listing.title?.toLowerCase().includes(listingSearch.toLowerCase()) ||
    listing.description?.toLowerCase().includes(listingSearch.toLowerCase()) ||
    listing.category?.toLowerCase().includes(listingSearch.toLowerCase()) ||
    listing.price?.toString().includes(listingSearch)
  );

  const filteredEvents = events.filter(event => 
    event.title?.toLowerCase().includes(eventSearch.toLowerCase()) ||
    event.description?.toLowerCase().includes(eventSearch.toLowerCase()) ||
    event.location?.toLowerCase().includes(eventSearch.toLowerCase()) ||
    event.date?.toLowerCase().includes(eventSearch.toLowerCase())
  );

  // Onaylƒ± ve onaysƒ±z etkinlikleri ayƒ±r
  const approvedEvents = filteredEvents.filter(event => event.isApproved === true);
  const pendingEventsForApproval = filteredEvents.filter(event => 
    event.isApproved === false || event.isApproved === undefined || event.isApproved === null
  );

  const filteredNotes = notes.filter(note => 
    note.title?.toLowerCase().includes(noteSearch.toLowerCase()) ||
    note.description?.toLowerCase().includes(noteSearch.toLowerCase()) ||
    note.subject?.toLowerCase().includes(noteSearch.toLowerCase()) ||
    note.university?.toLowerCase().includes(noteSearch.toLowerCase())
  );

  const filteredRoommates = roommates.filter(roommate => 
    !roommate.isDeleted && (
      roommate.name?.toLowerCase().includes(roommateSearch.toLowerCase()) ||
      roommate.university?.toLowerCase().includes(roommateSearch.toLowerCase()) ||
      roommate.department?.toLowerCase().includes(roommateSearch.toLowerCase()) ||
      roommate.location?.toLowerCase().includes(roommateSearch.toLowerCase()) ||
      roommate.type?.toLowerCase().includes(roommateSearch.toLowerCase())
    )
  );

  // ƒ∞statistik hesaplamalarƒ±
  const totalUsers = users.length;
  const totalAdmins = users.filter(user => user.role === "admin").length;
  const totalListings = listings.length;
  const totalEvents = events.length;
  const totalNotes = notes.length;
  const pendingNotes = notes.filter(note => !note.isApproved).length;
  
  // Ev arkada≈üƒ± istatistikleri - silinmi≈ü olanlarƒ± hari√ß tut
  const activeRoommates = roommates.filter(roommate => !roommate.isDeleted);
  const totalRoommates = activeRoommates.length;
  const pendingRoommates = activeRoommates.filter(roommate => roommate.isApproved !== true).length;
  
  const pendingListings = listings.filter(listing => !listing.isApproved).length;
  const pendingEvents = events.filter(event => !event.isApproved).length;
  const recentUsers = users.filter(user => {
    if (!user.createdAt) return false;
    const userDate = new Date(user.createdAt.seconds * 1000);
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    return userDate > weekAgo;
  }).length;

  // DEBUG: Ev arkada≈üƒ± istatistikleri
  console.log('üìä Admin Panel ƒ∞statistikleri - Ev Arkada≈üƒ±:');
  console.log('  - Toplam aktif ilan:', totalRoommates);
  console.log('  - Onay bekleyen:', pendingRoommates);
  console.log('  - Onaylanmƒ±≈ü:', activeRoommates.filter(roommate => roommate.isApproved === true).length);
  console.log('  - Onaysƒ±z:', activeRoommates.filter(roommate => roommate.isApproved === false).length);
  console.log('  - Durum belirsiz:', activeRoommates.filter(roommate => roommate.isApproved === undefined || roommate.isApproved === null).length);
  console.log('  - Silinmi≈ü ilanlar:', roommates.filter(roommate => roommate.isDeleted).length);
  console.log('  - T√ºm aktif ilanlar:', activeRoommates.map((r: any) => ({
    id: r.id,
    name: r.name,
    isApproved: r.isApproved,
    isDeleted: r.isDeleted
  })));

  // Toplu se√ßim fonksiyonlarƒ±
  const handleSelectAllUsers = (checked: boolean) => {
    if (checked) {
      setSelectedUsers(filteredUsers.map(user => user.id));
    } else {
      setSelectedUsers([]);
    }
  };

  const handleSelectAllListings = (checked: boolean) => {
    if (checked) {
      setSelectedListings(filteredListings.map(listing => listing.id));
    } else {
      setSelectedListings([]);
    }
  };

  const handleSelectAllEvents = (checked: boolean) => {
    if (checked) {
      setSelectedEvents(filteredEvents.map(event => event.id));
    } else {
      setSelectedEvents([]);
    }
  };

  const handleSelectAllNotes = (checked: boolean) => {
    if (checked) {
      setSelectedNotes(filteredNotes.map(note => note.id));
    } else {
      setSelectedNotes([]);
    }
  };

  const handleSelectAllRoommates = (checked: boolean) => {
    if (checked) {
      setSelectedRoommates(filteredRoommates.map(roommate => roommate.id));
    } else {
      setSelectedRoommates([]);
    }
  };

  // Toplu i≈ülem fonksiyonlarƒ±
  const handleBulkDeleteUsers = async () => {
    if (!window.confirm(`${selectedUsers.length} kullanƒ±cƒ±yƒ± silmek istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedUsers.forEach(userId => {
        if (userId !== userId) { // Kendini silmeye √ßalƒ±≈ümasƒ±n
          batch.delete(doc(db, "users", userId));
        }
      });
      await batch.commit();
      setSelectedUsers([]);
    } catch (e) {
      alert("Toplu silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkDeleteListings = async () => {
    if (!window.confirm(`${selectedListings.length} ilanƒ± silmek istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedListings.forEach(listingId => {
        batch.delete(doc(db, "secondhand", listingId));
      });
      await batch.commit();
      setSelectedListings([]);
    } catch (e) {
      alert("Toplu silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkDeleteEvents = async () => {
    if (!window.confirm(`${selectedEvents.length} etkinliƒüi silmek istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedEvents.forEach(eventId => {
        batch.delete(doc(db, "events", eventId));
      });
      await batch.commit();
      setSelectedEvents([]);
    } catch (e) {
      alert("Toplu silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkDeleteNotes = async () => {
    if (!window.confirm(`${selectedNotes.length} notu silmek istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedNotes.forEach(noteId => {
        batch.delete(doc(db, "notes", noteId));
      });
      await batch.commit();
      setSelectedNotes([]);
    } catch (e) {
      alert("Toplu silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkApproveNotes = async () => {
    if (!window.confirm(`${selectedNotes.length} notu onaylamak istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      const noteData: any[] = [];
      
      selectedNotes.forEach(noteId => {
        const note = notes.find(n => n.id === noteId);
        if (note) {
          noteData.push(note);
        }
        batch.update(doc(db, "notes", noteId), {
          isApproved: true,
          approvedAt: new Date(),
          approvedBy: userId
        });
      });
      
      await batch.commit();
      
      // ƒ∞√ßerik sahiplerine bildirim g√∂nder
      for (const note of noteData) {
        if (note.userId) {
          try {
            await sendNotification({
              userId: note.userId,
              title: `Notunuz Onaylandƒ±`,
              message: `"${note.title}" ba≈ülƒ±klƒ± notunuz onaylandƒ± ve yayƒ±nlandƒ±.`,
              type: 'success',
              actionUrl: '/notlar',
              actionText: 'Notlarƒ±mƒ± G√∂r√ºnt√ºle'
            });
          } catch (notifError) {
            console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
          }
        }
      }
      
      setSelectedNotes([]);
      alert(`${selectedNotes.length} not ba≈üarƒ±yla onaylandƒ±!`);
    } catch (e) {
      alert("Toplu onaylama i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkMakeAdmin = async () => {
    if (!window.confirm(`${selectedUsers.length} kullanƒ±cƒ±yƒ± admin yapmak istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedUsers.forEach(userId => {
        batch.update(doc(db, "users", userId), { role: "admin" });
      });
      await batch.commit();
      
      // Se√ßili kullanƒ±cƒ±lara bildirim g√∂nder
      for (const userId of selectedUsers) {
        try {
          await sendNotification({
            userId: userId,
            title: `Admin Yetkisi Verildi`,
            message: 'Hesabƒ±nƒ±za admin yetkisi verildi. Artƒ±k admin paneline eri≈üebilirsiniz.',
            type: 'success',
            actionUrl: '/admin',
            actionText: 'Admin Paneli'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      setSelectedUsers([]);
      alert(`${selectedUsers.length} kullanƒ±cƒ± ba≈üarƒ±yla admin yapƒ±ldƒ±!`);
    } catch (e) {
      alert("Toplu admin yapma i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkApproveRoommates = async () => {
    if (!window.confirm(`${selectedRoommates.length} ev arkada≈üƒ± ilanƒ±nƒ± onaylamak istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      const roommateData: any[] = [];
      
      selectedRoommates.forEach(roommateId => {
        const roommate = roommates.find(r => r.id === roommateId);
        if (roommate) {
          roommateData.push(roommate);
        }
        batch.update(doc(db, "roommates", roommateId), { isApproved: true });
      });
      
      await batch.commit();
      
      // ƒ∞√ßerik sahiplerine bildirim g√∂nder
      for (const roommate of roommateData) {
        if (roommate.userId) {
          try {
            await sendNotification({
              userId: roommate.userId,
              title: `Ev Arkada≈üƒ± ƒ∞lanƒ±nƒ±z Onaylandƒ±`,
              message: `"${roommate.name}" ba≈ülƒ±klƒ± ev arkada≈üƒ± ilanƒ±nƒ±z onaylandƒ± ve yayƒ±nlandƒ±.`,
              type: 'success',
              actionUrl: '/ev-arkadasi',
              actionText: 'ƒ∞lanlarƒ±mƒ± G√∂r√ºnt√ºle'
            });
          } catch (notifError) {
            console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
          }
        }
      }
      
      setSelectedRoommates([]);
      alert(`${selectedRoommates.length} ev arkada≈üƒ± ilanƒ± ba≈üarƒ±yla onaylandƒ±!`);
    } catch (e) {
      alert("Toplu onaylama i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkDeleteRoommates = async () => {
    if (!window.confirm(`${selectedRoommates.length} ev arkada≈üƒ± ilanƒ±nƒ± silmek istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedRoommates.forEach(roommateId => {
        batch.delete(doc(db, "roommates", roommateId));
      });
      await batch.commit();
      setSelectedRoommates([]);
    } catch (e) {
      alert("Toplu silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleBulkApproveListings = async () => {
    if (!window.confirm(`${selectedListings.length} ikinci el ilanƒ±nƒ± onaylamak istediƒüinize emin misiniz?`)) return;
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      const listingData: any[] = [];
      
      selectedListings.forEach(listingId => {
        const listing = listings.find(l => l.id === listingId);
        if (listing) {
          listingData.push(listing);
        }
        batch.update(doc(db, "secondhand", listingId), { 
          isApproved: true,
          approvedAt: new Date(),
          approvedBy: userId
        });
      });
      
      await batch.commit();
      
      // ƒ∞√ßerik sahiplerine bildirim g√∂nder
      for (const listing of listingData) {
        if (listing.userId) {
          try {
            await sendNotification({
              userId: listing.userId,
              title: `ƒ∞lanƒ±nƒ±z Onaylandƒ±`,
              message: `"${listing.title}" ba≈ülƒ±klƒ± ilanƒ±nƒ±z onaylandƒ± ve yayƒ±nlandƒ±.`,
              type: 'success',
              actionUrl: '/ikinci-el',
              actionText: 'ƒ∞lanlarƒ±mƒ± G√∂r√ºnt√ºle'
            });
          } catch (notifError) {
            console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
          }
        }
      }
      
      setSelectedListings([]);
      alert(`${selectedListings.length} ilan ba≈üarƒ±yla onaylandƒ±!`);
    } catch (e) {
      alert("Toplu onaylama i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm("Bu kullanƒ±cƒ±yƒ± silmek istediƒüinize emin misiniz?")) return;
    setActionLoading(id);
    try {
      await deleteDoc(doc(db, "users", id));
    } catch (e) {
      alert("Silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setActionLoading(null);
  };

  const handleToggleAdmin = async (id: string, currentRole: string) => {
    const newRole = currentRole === "admin" ? "user" : "admin";
    setActionLoading(id);
    try {
      await updateDoc(doc(db, "users", id), { role: newRole });
    } catch (e) {
      alert("G√ºncelleme ba≈üarƒ±sƒ±z: " + e);
    }
    setActionLoading(null);
  };

  // Kullanƒ±cƒ± banlama/ban kaldƒ±rma
  const handleToggleBan = async (id: string, currentBanStatus: boolean) => {
    const action = currentBanStatus ? "ban kaldƒ±rmak" : "yasaklamak";
    if (!window.confirm(`Bu kullanƒ±cƒ±yƒ± ${action} istediƒüinize emin misiniz?`)) return;
    
    setActionLoading(id);
    try {
      const banReason = currentBanStatus ? null : prompt("Yasaklama sebebi (opsiyonel):");
      await updateDoc(doc(db, "users", id), { 
        isBanned: !currentBanStatus,
        banReason: banReason || null,
        bannedAt: !currentBanStatus ? new Date() : null,
        bannedBy: !currentBanStatus ? (userId || 'admin') : null
      });
      
      // Kullanƒ±cƒ±ya bildirim g√∂nder
      try {
        if (!currentBanStatus) {
          // Banlama bildirimi
          await sendNotification({
            userId: id,
            title: `Hesabƒ±nƒ±z Yasaklandƒ±`,
            message: banReason ? `Hesabƒ±nƒ±z yasaklandƒ±. Sebep: ${banReason}` : 'Hesabƒ±nƒ±z yasaklandƒ±.',
            type: 'error',
            actionUrl: '/banned',
            actionText: 'Detaylarƒ± G√∂r√ºnt√ºle'
          });
        } else {
          // Ban kaldƒ±rma bildirimi
          await sendNotification({
            userId: id,
            title: `Hesap Yasaklamasƒ± Kaldƒ±rƒ±ldƒ±`,
            message: 'Hesabƒ±nƒ±zƒ±n yasaklamasƒ± kaldƒ±rƒ±ldƒ±. Artƒ±k giri≈ü yapabilirsiniz.',
            type: 'success',
            actionUrl: '/',
            actionText: 'Ana Sayfaya Git'
          });
        }
      } catch (notifError) {
        console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
      }
      
      alert(`Kullanƒ±cƒ± ba≈üarƒ±yla ${currentBanStatus ? 'ban kaldƒ±rƒ±ldƒ±' : 'yasaklandƒ±'}!`);
    } catch (e) {
      alert(`${action.charAt(0).toUpperCase() + action.slice(1)} i≈ülemi ba≈üarƒ±sƒ±z: ` + e);
    }
    setActionLoading(null);
  };

  // Kullanƒ±cƒ± rol deƒüi≈ütirme (moderator, admin, user)
  const handleChangeRole = async (id: string, newRole: string) => {
    if (!window.confirm(`Bu kullanƒ±cƒ±nƒ±n rol√ºn√º "${newRole}" yapmak istediƒüinize emin misiniz?`)) return;
    
    setActionLoading(id);
    try {
      // Kullanƒ±cƒ± bilgilerini al
      const userToUpdate = users.find(u => u.id === id);
      const userEmail = userToUpdate?.email || 'Bilinmeyen kullanƒ±cƒ±';
      
      await updateDoc(doc(db, "users", id), { 
        role: newRole,
        roleChangedAt: new Date(),
        roleChangedBy: userId || 'admin'
      });
      
      // Kullanƒ±cƒ±ya bildirim g√∂nder
      try {
        console.log('üîî Admin paneli - Bildirim g√∂nderiliyor:', {
          userId: id,
          title: `Rol Deƒüi≈üikliƒüi`,
          message: `Hesabƒ±nƒ±zƒ±n rol√º "${newRole}" olarak g√ºncellendi.`,
          type: 'info'
        });
        
        await sendNotification({
          userId: id,
          title: `Rol Deƒüi≈üikliƒüi`,
          message: `Hesabƒ±nƒ±zƒ±n rol√º "${newRole}" olarak g√ºncellendi.`,
          type: 'info',
          actionUrl: '/ayarlar',
          actionText: 'Ayarlarƒ± G√∂r√ºnt√ºle'
        });
        
        console.log('‚úÖ Admin paneli - Bildirim ba≈üarƒ±yla g√∂nderildi');
      } catch (notifError) {
        console.error('‚ùå Admin paneli - Bildirim g√∂nderme hatasƒ±:', notifError);
      }
      
      alert(`Kullanƒ±cƒ± rol√º ba≈üarƒ±yla "${newRole}" olarak deƒüi≈ütirildi!`);
    } catch (e) {
      alert("Rol deƒüi≈ütirme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setActionLoading(null);
  };

  // ƒ∞√ßerik moderasyonu - onaylama/reddetme
  const handleModerateContent = async (collectionName: string, id: string, action: 'approve' | 'reject', reason?: string) => {
    const actionText = action === 'approve' ? 'onaylamak' : 'reddetmek';
    if (!window.confirm(`Bu i√ßeriƒüi ${actionText} istediƒüinize emin misiniz?`)) return;
    
    setActionLoading(id);
    try {
      // ƒ∞√ßerik bilgilerini al
      let contentData: any = {};
      let contentTitle = '';
      let contentUserId = '';
      
      if (collectionName === 'secondhand') {
        contentData = listings.find(l => l.id === id);
        contentTitle = contentData?.title || 'ƒ∞lan';
        contentUserId = contentData?.userId || '';
      } else if (collectionName === 'events') {
        contentData = events.find(e => e.id === id);
        contentTitle = contentData?.title || 'Etkinlik';
        contentUserId = contentData?.userId || '';
      } else if (collectionName === 'notes') {
        contentData = notes.find(n => n.id === id);
        contentTitle = contentData?.title || 'Not';
        contentUserId = contentData?.userId || '';
      } else if (collectionName === 'roommates') {
        contentData = roommates.find(r => r.id === id);
        contentTitle = contentData?.name || 'Ev Arkada≈üƒ± ƒ∞lanƒ±';
        contentUserId = contentData?.userId || '';
      }
      
      const updateData: any = {
        isApproved: action === 'approve',
        moderatedAt: new Date(),
        moderatedBy: userId || 'admin'
      };
      
      if (action === 'reject' && reason) {
        updateData.rejectionReason = reason;
      }
      
      await updateDoc(doc(db, collectionName, id), updateData);
      
      // ƒ∞√ßerik sahibine bildirim g√∂nder
      if (contentUserId) {
        try {
          const contentType = collectionName === 'secondhand' ? 'ƒ∞lanƒ±nƒ±z' : 
                             collectionName === 'events' ? 'Etkinliƒüiniz' :
                             collectionName === 'notes' ? 'Notunuz' :
                             collectionName === 'roommates' ? 'Ev arkada≈üƒ± ilanƒ±nƒ±z' : 'ƒ∞√ßeriƒüiniz';
          
          await sendNotification({
            userId: contentUserId,
            title: action === 'approve' ? `${contentType} Onaylandƒ±` : `${contentType} Reddedildi`,
            message: action === 'approve' 
              ? `"${contentTitle}" ba≈ülƒ±klƒ± ${contentType.toLowerCase()} onaylandƒ± ve yayƒ±nlandƒ±.`
              : `"${contentTitle}" ba≈ülƒ±klƒ± ${contentType.toLowerCase()} reddedildi.${reason ? ` Sebep: ${reason}` : ''}`,
            type: action === 'approve' ? 'success' : 'warning',
            actionUrl: `/${collectionName === 'secondhand' ? 'ikinci-el' : 
                         collectionName === 'events' ? 'etkinlikler' :
                         collectionName === 'notes' ? 'notlar' :
                         collectionName === 'roommates' ? 'ev-arkadasi' : ''}`,
            actionText: 'ƒ∞√ßeriklerimi G√∂r√ºnt√ºle'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      alert(`ƒ∞√ßerik ba≈üarƒ±yla ${action === 'approve' ? 'onaylandƒ±' : 'reddedildi'}!`);
    } catch (e) {
      alert(`Moderasyon i≈ülemi ba≈üarƒ±sƒ±z: ` + e);
    }
    setActionLoading(null);
  };

  // Toplu kullanƒ±cƒ± banlama
  const handleBulkBanUsers = async () => {
    if (selectedUsers.length === 0) {
      alert("L√ºtfen banlanacak kullanƒ±cƒ±larƒ± se√ßin!");
      return;
    }
    
    const reason = prompt("Toplu yasaklama sebebi:");
    if (!window.confirm(`${selectedUsers.length} kullanƒ±cƒ±yƒ± yasaklamak istediƒüinize emin misiniz?`)) return;
    
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedUsers.forEach(userId => {
        const userRef = doc(db, "users", userId);
        batch.update(userRef, {
          isBanned: true,
          banReason: reason || 'Toplu yasaklama',
          bannedAt: new Date(),
          bannedBy: userId || 'admin'
        });
      });
      await batch.commit();
      
      // Se√ßili kullanƒ±cƒ±lara bildirim g√∂nder
      for (const userId of selectedUsers) {
        try {
          await sendNotification({
            userId: userId,
            title: `Hesabƒ±nƒ±z Yasaklandƒ±`,
            message: reason ? `Hesabƒ±nƒ±z yasaklandƒ±. Sebep: ${reason}` : 'Hesabƒ±nƒ±z yasaklandƒ±.',
            type: 'error',
            actionUrl: '/banned',
            actionText: 'Detaylarƒ± G√∂r√ºnt√ºle'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      setSelectedUsers([]);
      alert(`${selectedUsers.length} kullanƒ±cƒ± ba≈üarƒ±yla yasaklandƒ±!`);
    } catch (e) {
      alert("Toplu yasaklama i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  // Toplu kullanƒ±cƒ± ban kaldƒ±rma
  const handleBulkUnbanUsers = async () => {
    if (selectedUsers.length === 0) {
      alert("L√ºtfen ban kaldƒ±rƒ±lacak kullanƒ±cƒ±larƒ± se√ßin!");
      return;
    }
    
    if (!window.confirm(`${selectedUsers.length} kullanƒ±cƒ±nƒ±n banƒ±nƒ± kaldƒ±rmak istediƒüinize emin misiniz?`)) return;
    
    setBulkActionLoading(true);
    try {
      const batch = writeBatch(db);
      selectedUsers.forEach(userId => {
        const userRef = doc(db, "users", userId);
        batch.update(userRef, {
          isBanned: false,
          banReason: null,
          bannedAt: null,
          bannedBy: null
        });
      });
      await batch.commit();
      
      // Se√ßili kullanƒ±cƒ±lara bildirim g√∂nder
      for (const userId of selectedUsers) {
        try {
          await sendNotification({
            userId: userId,
            title: `Hesap Yasaklamasƒ± Kaldƒ±rƒ±ldƒ±`,
            message: 'Hesabƒ±nƒ±zƒ±n yasaklamasƒ± kaldƒ±rƒ±ldƒ±. Artƒ±k giri≈ü yapabilirsiniz.',
            type: 'success',
            actionUrl: '/',
            actionText: 'Ana Sayfaya Git'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      setSelectedUsers([]);
      alert(`${selectedUsers.length} kullanƒ±cƒ±nƒ±n banƒ± ba≈üarƒ±yla kaldƒ±rƒ±ldƒ±!`);
    } catch (e) {
      alert("Toplu ban kaldƒ±rma i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setBulkActionLoading(false);
  };

  const handleDeleteListing = async (id: string) => {
    if (!window.confirm("Bu ilanƒ± silmek istediƒüinize emin misiniz?")) return;
    setListingActionLoading(id);
    try {
      await deleteDoc(doc(db, "secondhand", id));
    } catch (e) {
      alert("Silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setListingActionLoading(null);
  };

  const handleDeleteEvent = async (id: string) => {
    if (!window.confirm("Bu etkinliƒüi silmek istediƒüinize emin misiniz?")) return;
    
    console.log('üóëÔ∏è ETKƒ∞NLƒ∞K Sƒ∞Lƒ∞Nƒ∞YOR - ID:', id);
    console.log('üîç Event ID tipi:', typeof id, 'Uzunluk:', id.length);
    
    // ID format kontrol√º
    if (!id || id.length < 5) {
      console.error('‚ùå Ge√ßersiz ID formatƒ±:', id);
      alert(`Ge√ßersiz etkinlik ID formatƒ±: "${id}"`);
      return;
    }
    
    const cleanId = String(id).trim();
    const eventToDelete = events.find(e => e.id === cleanId);
    
    if (!eventToDelete) {
      console.error('‚ùå Silinecek etkinlik bulunamadƒ±! ID:', cleanId);
      alert(`Etkinlik bulunamadƒ±! ID: ${cleanId}`);
      return;
    }
    
    setEventActionLoading(cleanId);
    try {
      // Firebase'den sil
      await deleteDoc(doc(db, "events", cleanId));
      console.log('‚úÖ Firebase\'den ba≈üarƒ±yla silindi');
      
      // STATE'den hemen sil (optimistic update)
      setEvents(prevEvents => prevEvents.filter(event => event.id !== cleanId));
      
      alert(`Etkinlik ba≈üarƒ±yla silindi: ${eventToDelete.title}`);
      
    } catch (e: any) {
      console.error('‚ùå Silme hatasƒ±:', e);
      alert(`Silme i≈ülemi ba≈üarƒ±sƒ±z:\n${e.message || e}`);
      
      // Hata durumunda liste yenile
      try {
        const eventsRef = collection(db, "events");
        const snap = await getDocs(eventsRef);
        const fetchedEvents = snap.docs.map(doc => {
          const data = doc.data();
          const { id: dataId, ...cleanData } = data; // data.id'yi √ßƒ±kar
          return { 
            id: doc.id,  // Firebase document ID (tek doƒüru ID)
            ...cleanData  // data.id olmadan diƒüer t√ºm veriler
          };
        });
        
        // Sƒ±ralama yap
        const sortedEvents = fetchedEvents.sort((a: any, b: any) => {
          const getTimestamp = (createdAt: any) => {
            if (!createdAt) return 0;
            if (createdAt.seconds) return createdAt.seconds * 1000;
            if (typeof createdAt === 'string') return new Date(createdAt).getTime();
            return 0;
          };
          return getTimestamp(b.createdAt) - getTimestamp(a.createdAt);
        });
        
        setEvents(sortedEvents);
      } catch (refreshError) {
        console.error('Liste yenileme hatasƒ±:', refreshError);
      }
    }
    setEventActionLoading(null);
  };

    const handleApproveEvent = async (id: string) => {
    console.log('üîç Etkinlik onaylanƒ±yor - ID:', id);
    
    // ID format kontrol√º
    if (!id || id.length < 5) {
      console.error('‚ùå Ge√ßersiz ID formatƒ±:', id);
      alert(`Ge√ßersiz etkinlik ID formatƒ±: "${id}"`);
      return;
    }
    
    setEventActionLoading(id);
    try {
      // String'e √ßevir ve trimle
      const cleanId = String(id).trim();
      console.log('üßπ Temizlenmi≈ü ID:', cleanId);
      
      // √ñnce local state'de var mƒ± kontrol et
      const localEvent = events.find(e => e.id === cleanId);
      if (!localEvent) {
        console.error('‚ùå Event local state\'de bulunamadƒ±! ID:', cleanId);
        console.log('üìä Mevcut events:', events.length);
        
        // Firebase'den t√ºm etkinlikleri tekrar √ßek
        console.log('üîÑ Firebase\'den etkinlikler yeniden √ßekiliyor...');
        const eventsRef = collection(db, "events");
        const snap = await getDocs(eventsRef);
        const fetchedEvents = snap.docs.map(doc => {
          const data = doc.data();
          const { id: dataId, ...cleanData } = data; // data.id'yi √ßƒ±kar
          return { 
            id: doc.id,  // Firebase document ID (tek doƒüru ID)
            ...cleanData  // data.id olmadan diƒüer t√ºm veriler
          };
        });
        
        // Sƒ±ralama yap
        const sortedEvents = fetchedEvents.sort((a: any, b: any) => {
          const getTimestamp = (createdAt: any) => {
            if (!createdAt) return 0;
            if (createdAt.seconds) return createdAt.seconds * 1000;
            if (typeof createdAt === 'string') return new Date(createdAt).getTime();
            return 0;
          };
          return getTimestamp(b.createdAt) - getTimestamp(a.createdAt);
        });
        
        setEvents(sortedEvents);
        
        // Tekrar kontrol et
        const refreshedEvent = sortedEvents.find(e => e.id === cleanId);
        if (!refreshedEvent) {
          alert(`Etkinlik bulunamadƒ±! ID: ${cleanId}\n\nFirebase'de ${sortedEvents.length} etkinlik var ama bu ID bulunamƒ±yor.`);
          setEventActionLoading(null);
          return;
        }
        console.log('‚úÖ Firebase refresh sonrasƒ± etkinlik bulundu');
      }
      
      // Firebase dok√ºmanƒ±nƒ± kontrol et
      const eventRef = doc(db, "events", cleanId);
      const eventSnap = await getDoc(eventRef);
      
      if (!eventSnap.exists()) {
        console.error('‚ùå Firebase\'de event bulunamadƒ±! ID:', cleanId);
        
        // T√ºm etkinlik ID'lerini Firebase'den √ßek ve kar≈üƒ±la≈ütƒ±r
        console.log('üîç Firebase\'deki t√ºm etkinlik ID\'leri kontrol ediliyor...');
        const allEventsRef = collection(db, "events");
        const allEventsSnap = await getDocs(allEventsRef);
        const allFirebaseIds = allEventsSnap.docs.map(doc => doc.id);
        
        console.log('üìã Firebase\'deki t√ºm ID\'ler:', allFirebaseIds);
        console.log('üîç Aranan ID:', cleanId);
        console.log('üîç Aranan ID Firebase\'de var mƒ±?', allFirebaseIds.includes(cleanId));
        
        // En yakƒ±n ID'leri bul
        const similarIds = allFirebaseIds.filter(id => 
          id.includes(cleanId.substring(0, 10)) || cleanId.includes(id.substring(0, 10))
        );
        console.log('üîç Benzer ID\'ler:', similarIds);
        
        alert(`Firebase\'de etkinlik bulunamadƒ±! 
        
Aranan ID: ${cleanId}
Firebase\'deki etkinlik sayƒ±sƒ±: ${allFirebaseIds.length}
Benzer ID\'ler: ${similarIds.join(', ') || 'Yok'}`);
        setEventActionLoading(null);
        return;
      }
      
      const eventData = eventSnap.data();
      
      // Onaylama i≈ülemi
      await updateDoc(eventRef, { 
        isApproved: true,
        isVerified: true,
        approvedAt: new Date(),
        approvedBy: userId || 'admin-bypass'
      });
      
      // STATE'de g√ºncelle
      setEvents(prevEvents => prevEvents.map(event => 
        event.id === cleanId 
          ? { ...event, isApproved: true, approvedAt: new Date(), approvedBy: userId || 'admin-bypass' }
          : event
      ));
      
      // Etkinlik sahibine bildirim g√∂nder
      if (eventData.userId) {
        try {
          await sendNotification({
            userId: eventData.userId,
            title: `Etkinliƒüiniz Onaylandƒ±`,
            message: `"${eventData.title}" ba≈ülƒ±klƒ± etkinliƒüiniz onaylandƒ± ve yayƒ±nlandƒ±.`,
            type: 'success',
            actionUrl: '/etkinlikler',
            actionText: 'Etkinliklerimi G√∂r√ºnt√ºle'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      alert(`‚úÖ Etkinlik ba≈üarƒ±yla onaylandƒ±: ${eventData.title}`);
      
    } catch (e: any) {
      console.error('‚ùå Onaylama hatasƒ±:', e);
      alert(`Onaylama i≈ülemi ba≈üarƒ±sƒ±z:\n${e.message || e}`);
    }
    setEventActionLoading(null);
  };

  const handleDeleteNote = async (id: string) => {
    if (!window.confirm("Bu notu silmek istediƒüinize emin misiniz?")) return;
    setNoteActionLoading(id);
    try {
      await deleteDoc(doc(db, "notes", id));
    } catch (e) {
      alert("Silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setNoteActionLoading(null);
  };

  const handleApproveNote = async (id: string) => {
    setNoteActionLoading(id);
    try {
      console.log('üîç Not onaylanƒ±yor:', id);
      
      // Not bilgilerini al
      const note = notes.find(n => n.id === id);
      const noteTitle = note?.title || 'Not';
      
      await updateDoc(doc(db, "notes", id), { 
        isApproved: true,
        approvedAt: new Date(),
        approvedBy: userId
      });
      
      // Not sahibine bildirim g√∂nder
      if (note?.userId) {
        try {
          await sendNotification({
            userId: note.userId,
            title: `Notunuz Onaylandƒ±`,
            message: `"${noteTitle}" ba≈ülƒ±klƒ± notunuz onaylandƒ± ve yayƒ±nlandƒ±.`,
            type: 'success',
            actionUrl: '/notlar',
            actionText: 'Notlarƒ±mƒ± G√∂r√ºnt√ºle'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      console.log('‚úÖ Not ba≈üarƒ±yla onaylandƒ±:', id);
      alert("Not ba≈üarƒ±yla onaylandƒ±!");
    } catch (e) {
      console.error('‚ùå Not onaylama hatasƒ±:', e);
      alert("Onaylama i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setNoteActionLoading(null);
  };

  const handleApproveRoommate = async (id: string) => {
    setRoommateActionLoading(id);
    try {
      console.log('üîç Ev arkada≈üƒ± ilanƒ± onaylanƒ±yor:', id);
      
      // Ev arkada≈üƒ± ilanƒ± bilgilerini al
      const roommate = roommates.find(r => r.id === id);
      const roommateName = roommate?.name || 'Ev Arkada≈üƒ± ƒ∞lanƒ±';
      
      await updateDoc(doc(db, "roommates", id), { 
        isApproved: true,
        approvedAt: new Date(),
        approvedBy: userId
      });
      
      // ƒ∞lan sahibine bildirim g√∂nder
      if (roommate?.userId) {
        try {
          await sendNotification({
            userId: roommate.userId,
            title: `Ev Arkada≈üƒ± ƒ∞lanƒ±nƒ±z Onaylandƒ±`,
            message: `"${roommateName}" ba≈ülƒ±klƒ± ev arkada≈üƒ± ilanƒ±nƒ±z onaylandƒ± ve yayƒ±nlandƒ±.`,
            type: 'success',
            actionUrl: '/ev-arkadasi',
            actionText: 'ƒ∞lanlarƒ±mƒ± G√∂r√ºnt√ºle'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      console.log('‚úÖ Ev arkada≈üƒ± ilanƒ± ba≈üarƒ±yla onaylandƒ±:', id);
      alert("Ev arkada≈üƒ± ilanƒ± ba≈üarƒ±yla onaylandƒ±!");
    } catch (e) {
      console.error('‚ùå Ev arkada≈üƒ± onaylama hatasƒ±:', e);
      alert("Onaylama i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setRoommateActionLoading(null);
  };

  const handleDeleteRoommate = async (id: string) => {
    if (!window.confirm("Bu ev arkada≈üƒ± ilanƒ±nƒ± silmek istediƒüinize emin misiniz?")) return;
    setRoommateActionLoading(id);
    try {
      console.log('üóëÔ∏è Ev arkada≈üƒ± ilanƒ± siliniyor:', id);
      await deleteDoc(doc(db, "roommates", id));
      console.log('‚úÖ Ev arkada≈üƒ± ilanƒ± ba≈üarƒ±yla silindi:', id);
      alert("Ev arkada≈üƒ± ilanƒ± ba≈üarƒ±yla silindi!");
    } catch (e) {
      console.error('‚ùå Ev arkada≈üƒ± silme hatasƒ±:', e);
      alert("Silme i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setRoommateActionLoading(null);
  };

  // ƒ∞kinci el ilan onaylama fonksiyonu
  const handleApproveListing = async (id: string) => {
    setListingActionLoading(id);
    try {
      // ƒ∞lan bilgilerini al
      const listing = listings.find(l => l.id === id);
      const listingTitle = listing?.title || 'ƒ∞lan';
      
      await updateDoc(doc(db, "secondhand", id), { 
        isApproved: true,
        approvedAt: new Date(),
        approvedBy: userId
      });
      
      // ƒ∞lan sahibine bildirim g√∂nder
      if (listing?.userId) {
        try {
          await sendNotification({
            userId: listing.userId,
            title: `ƒ∞lanƒ±nƒ±z Onaylandƒ±`,
            message: `"${listingTitle}" ba≈ülƒ±klƒ± ilanƒ±nƒ±z onaylandƒ± ve yayƒ±nlandƒ±.`,
            type: 'success',
            actionUrl: '/ikinci-el',
            actionText: 'ƒ∞lanlarƒ±mƒ± G√∂r√ºnt√ºle'
          });
        } catch (notifError) {
          console.error('Bildirim g√∂nderme hatasƒ±:', notifError);
        }
      }
      
      alert("ƒ∞lan ba≈üarƒ±yla onaylandƒ±!");
    } catch (e) {
      alert("Onaylama i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setListingActionLoading(null);
  };

  // ƒ∞kinci el ilan premium yapma fonksiyonu
  const handleTogglePremiumListing = async (id: string, currentPremiumStatus: boolean) => {
    setListingActionLoading(id);
    try {
      await updateDoc(doc(db, "secondhand", id), { 
        isPremium: !currentPremiumStatus,
        premiumAt: !currentPremiumStatus ? new Date() : null,
        premiumBy: !currentPremiumStatus ? userId : null
      });
      
      // Ba≈üarƒ± mesajƒ± g√∂ster
      alert(!currentPremiumStatus ? "ƒ∞lan premium yapƒ±ldƒ±!" : "ƒ∞lan premium durumdan √ßƒ±karƒ±ldƒ±!");
      
      // Listings state'ini g√ºncelle
      setListings(prev => prev.map(listing => 
        listing.id === id 
          ? { ...listing, isPremium: !currentPremiumStatus }
          : listing
      ));
    } catch (e) {
      alert("Premium i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setListingActionLoading(null);
  };

  // Ev arkada≈üƒ± ilan premium yapma fonksiyonu
  const handleTogglePremiumRoommate = async (id: string, currentPremiumStatus: boolean) => {
    setRoommateActionLoading(id);
    try {
      await updateDoc(doc(db, "roommates", id), { 
        isPremium: !currentPremiumStatus,
        premiumAt: !currentPremiumStatus ? new Date() : null,
        premiumBy: !currentPremiumStatus ? userId : null
      });
      
      // Ba≈üarƒ± mesajƒ± g√∂ster
      alert(!currentPremiumStatus ? "ƒ∞lan premium yapƒ±ldƒ±!" : "ƒ∞lan premium durumdan √ßƒ±karƒ±ldƒ±!");
      
      // Roommates state'ini g√ºncelle
      setRoommates(prev => prev.map(roommate => 
        roommate.id === id 
          ? { ...roommate, isPremium: !currentPremiumStatus }
          : roommate
      ));
    } catch (e) {
      alert("Premium i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setRoommateActionLoading(null);
  };

  // Etkinlik premium yapma fonksiyonu
  const handleTogglePremiumEvent = async (id: string, currentPremiumStatus: boolean) => {
    setEventActionLoading(id);
    try {
      await updateDoc(doc(db, "events", id), { 
        isPremium: !currentPremiumStatus,
        premiumAt: !currentPremiumStatus ? new Date() : null,
        premiumBy: !currentPremiumStatus ? userId : null
      });
      
      // Ba≈üarƒ± mesajƒ± g√∂ster
      alert(!currentPremiumStatus ? "Etkinlik premium yapƒ±ldƒ±!" : "Etkinlik premium durumdan √ßƒ±karƒ±ldƒ±!");
      
      // Events state'ini g√ºncelle
      setEvents(prev => prev.map(event => 
        event.id === id 
          ? { ...event, isPremium: !currentPremiumStatus }
          : event
      ));
    } catch (e) {
      alert("Premium i≈ülemi ba≈üarƒ±sƒ±z: " + e);
    }
    setEventActionLoading(null);
  };



  // DEBUG LOG
  console.log('üöÄ Admin Panel Render:', {
    loading,
    isAdmin,
    events: events.length,
    eventsData: events.slice(0, 2),
    userId
  });

  if (loading) return <div>Y√ºkleniyor...</div>;
  // GE√áICI: Admin kontrol√ºn√º bypass et
  // if (!isAdmin) return <div>Eri≈üim yok</div>;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 transition-colors duration-200">
      <Header />
      <div className="container mx-auto px-4 py-8">
      {/* S√ºper Admin Kontrol Paneli */}
      <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6 rounded-lg shadow-lg mb-8">
        <h1 className="text-2xl font-bold mb-4">üîê S√ºper Admin Kontrol Paneli</h1>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="bg-white/20 p-4 rounded-lg">
            <h3 className="font-semibold mb-2">üë§ Mevcut Kullanƒ±cƒ±</h3>
            <p className="text-sm">Email: {user?.email || 'Y√ºkleniyor...'}</p>
            <p className="text-sm">Rol: {profile?.role || 'user'}</p>
            <p className="text-sm">UID: {user?.uid || 'Y√ºkleniyor...'}</p>
          </div>
          <div className="bg-white/20 p-4 rounded-lg">
            <h3 className="font-semibold mb-2">‚ö° Hƒ±zlƒ± ƒ∞≈ülemler</h3>
            <button
              onClick={async () => {
                if (!user?.uid) {
                  alert('Kullanƒ±cƒ± bilgisi bulunamadƒ±!');
                  return;
                }
                try {
                  await updateDoc(doc(db, "users", user.uid), {
                    role: 'super_admin',
                    isSuperAdmin: true,
                    permissions: ['all'],
                    roleChangedAt: new Date(),
                    roleChangedBy: 'self'
                  });
                  alert('‚úÖ S√ºper Admin yetkileri verildi! Sayfayƒ± yenileyin.');
                } catch (e) {
                  alert('‚ùå Hata: ' + e);
                }
              }}
              className="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-sm font-semibold"
            >
              üöÄ S√ºper Admin Yap
            </button>
            <button
              onClick={async () => {
                if (!user?.uid) {
                  alert('Kullanƒ±cƒ± bilgisi bulunamadƒ±!');
                  return;
                }
                try {
                  console.log('üß™ Test bildirimi ba≈ülatƒ±lƒ±yor...');
                  console.log('üë§ Mevcut kullanƒ±cƒ±:', user.uid);
                  console.log('üîß sendNotification fonksiyonu:', typeof sendNotification);
                  
                  // Firebase baƒülantƒ±sƒ±nƒ± test et
                  console.log('üî• Firebase baƒülantƒ±sƒ± test ediliyor...');
                  const testDoc = await addDoc(collection(db, 'test'), {
                    test: true,
                    timestamp: new Date()
                  });
                  console.log('‚úÖ Firebase baƒülantƒ±sƒ± ba≈üarƒ±lƒ±, test doc ID:', testDoc.id);
                  
                  // Test dok√ºmanƒ±nƒ± sil
                  await deleteDoc(testDoc);
                  console.log('üóëÔ∏è Test dok√ºmanƒ± silindi');
                  
                  // Bildirim g√∂nder
                  console.log('üì® Bildirim g√∂nderiliyor...');
                  const notificationData = {
                    userId: user.uid,
                    title: 'Test Bildirimi',
                    message: 'Bu bir test bildirimidir. Bildirim sistemi √ßalƒ±≈üƒ±yor!',
                    type: 'success' as const,
                    actionUrl: '/admin',
                    actionText: 'Admin Paneli'
                  };
                  
                  console.log('üìã Bildirim verisi:', notificationData);
                  
                  await sendNotification(notificationData);
                  
                  console.log('‚úÖ Test bildirimi tamamlandƒ±!');
                  alert('‚úÖ Test bildirimi g√∂nderildi! Console\'u kontrol edin ve zil ikonuna bakƒ±n.');
                } catch (e) {
                  console.error('‚ùå Test bildirimi hatasƒ±:', e);
                  alert('‚ùå Test bildirimi hatasƒ±: ' + e);
                }
              }}
              className="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm font-semibold mt-2"
            >
              üß™ Test Bildirimi G√∂nder
            </button>
          </div>
          <div className="bg-white/20 p-4 rounded-lg">
            <h3 className="font-semibold mb-2">üîß Sistem Durumu</h3>
            <p className="text-sm">Toplam Kullanƒ±cƒ±: {totalUsers}</p>
            <p className="text-sm">Banlƒ± Kullanƒ±cƒ±: {users.filter(u => u.isBanned).length}</p>
            <p className="text-sm">Admin Sayƒ±sƒ±: {totalAdmins}</p>
          </div>
        </div>
      </div>

      {/* ƒ∞statistikler */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700">
          <h2 className="text-xl font-semibold mb-2 text-gray-800 dark:text-white">Kullanƒ±cƒ±lar</h2>
          <p className="text-3xl font-bold text-blue-600">{totalUsers}</p>
          <p className="text-sm text-gray-500 dark:text-gray-400">Admin: {totalAdmins} | Banlƒ±: {users.filter(u => u.isBanned).length}</p>
        </div>
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700">
          <h2 className="text-xl font-semibold mb-2 text-gray-800 dark:text-white">ƒ∞lanlar</h2>
          <p className="text-3xl font-bold text-green-600">{totalListings}</p>
          <p className="text-sm text-gray-500 dark:text-gray-400">Onay Bekleyen: {pendingListings}</p>
        </div>
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700">
          <h2 className="text-xl font-semibold mb-2 text-gray-800 dark:text-white">Etkinlikler</h2>
          <p className="text-3xl font-bold text-purple-600">{totalEvents}</p>
          <p className="text-sm text-gray-500 dark:text-gray-400">Onay Bekleyen: {pendingEvents}</p>
        </div>
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700">
          <h2 className="text-xl font-semibold mb-2 text-gray-800 dark:text-white">Notlar</h2>
          <p className="text-3xl font-bold text-yellow-600">{totalNotes}</p>
          <p className="text-sm text-gray-500 dark:text-gray-400">Onay Bekleyen: {pendingNotes}</p>
        </div>
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700">
          <h2 className="text-xl font-semibold mb-2 text-gray-800 dark:text-white">Ev Arkada≈üƒ± ƒ∞lanlarƒ±</h2>
          <p className="text-3xl font-bold text-indigo-600">{totalRoommates}</p>
          <p className="text-sm text-gray-500 dark:text-gray-400">Onay Bekleyen: {pendingRoommates}</p>
        </div>
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700">
          <h2 className="text-xl font-semibold mb-2 text-gray-800 dark:text-white">Yeni Kullanƒ±cƒ±lar</h2>
          <p className="text-3xl font-bold text-red-600">{recentUsers}</p>
          <p className="text-sm text-gray-500 dark:text-gray-400">Son 7 g√ºn</p>
        </div>
      </div>

              {/* Kullanƒ±cƒ±lar Tablosu */}
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow mb-8 border border-gray-200 dark:border-gray-700">
          <div className="p-6 border-b border-gray-200 dark:border-gray-700">
            <div className="mb-4">
              <h2 className="text-xl font-semibold mb-2 text-gray-800 dark:text-white">üë• Kullanƒ±cƒ± Y√∂netimi</h2>
              <div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                <div className="flex">
                  <div className="flex-shrink-0">
                    <svg className="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                      <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                    </svg>
                  </div>
                  <div className="ml-3">
                    <h3 className="text-sm font-medium text-blue-800">ƒ∞≈ülem Farklarƒ±:</h3>
                    <div className="mt-2 text-sm text-blue-700">
                      <p><strong>üö´ Banla:</strong> Kullanƒ±cƒ±yƒ± ge√ßici olarak yasaklar, hesap silinmez, sadece giri≈ü yapamaz</p>
                      <p><strong>üíÄ Kalƒ±cƒ± Sil:</strong> Kullanƒ±cƒ±yƒ± tamamen siler, t√ºm verileri kaybolur, geri alƒ±namaz!</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div className="flex justify-between items-center mb-4">
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="Kullanƒ±cƒ± ara..."
                value={userSearch}
                onChange={(e) => setUserSearch(e.target.value)}
                className="border rounded px-3 py-1"
              />
                              <button
                  onClick={() => handleBulkBanUsers()}
                  disabled={selectedUsers.length === 0 || bulkActionLoading}
                  className="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
                  title="Se√ßili kullanƒ±cƒ±larƒ± ge√ßici olarak yasakla"
                >
                  üö´ Toplu Banla ({selectedUsers.length})
                </button>
                <button
                  onClick={() => handleBulkUnbanUsers()}
                  disabled={selectedUsers.length === 0 || bulkActionLoading}
                  className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
                  title="Se√ßili kullanƒ±cƒ±larƒ±n banƒ±nƒ± kaldƒ±r"
                >
                  üîì Ban Kaldƒ±r ({selectedUsers.length})
                </button>
                <button
                  onClick={() => handleBulkMakeAdmin()}
                  disabled={selectedUsers.length === 0 || bulkActionLoading}
                  className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
                  title="Se√ßili kullanƒ±cƒ±larƒ± admin yap"
                >
                  üëë Admin Yap ({selectedUsers.length})
                </button>
                <button
                  onClick={() => {
                    const confirm = window.confirm(
                      `‚ö†Ô∏è Dƒ∞KKAT! Bu i≈ülem geri alƒ±namaz!\n\n` +
                      `${selectedUsers.length} kullanƒ±cƒ±yƒ± kalƒ±cƒ± olarak silmek istediƒüinize emin misiniz?\n\n` +
                      `Bu i≈ülem:\n` +
                      `‚Ä¢ T√ºm kullanƒ±cƒ± hesaplarƒ±nƒ± tamamen siler\n` +
                      `‚Ä¢ T√ºm verilerini (ilanlar, notlar, vb.) siler\n` +
                      `‚Ä¢ Geri alƒ±namaz!\n\n` +
                      `Banlama yerine silme yapmak istediƒüinizden emin misiniz?`
                    );
                    if (confirm) {
                      handleBulkDeleteUsers();
                    }
                  }}
                  disabled={selectedUsers.length === 0 || bulkActionLoading}
                  className="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm disabled:opacity-50 font-bold"
                  title="‚ö†Ô∏è KALICI Sƒ∞LME - T√ºm veriler kaybolur!"
                >
                  üíÄ Kalƒ±cƒ± Sil ({selectedUsers.length})
                </button>
            </div>
          </div>
          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead>
                <tr className="bg-gray-50">
                  <th className="py-2 px-4 text-left">
                    <input
                      type="checkbox"
                      checked={selectedUsers.length === filteredUsers.length && filteredUsers.length > 0}
                      onChange={(e) => handleSelectAllUsers(e.target.checked)}
                    />
                  </th>
                  <th className="py-2 px-4 text-left">Email</th>
                  <th className="py-2 px-4 text-left">ƒ∞sim</th>
                  <th className="py-2 px-4 text-left">Rol</th>
                  <th className="py-2 px-4 text-left">Durum</th>
                  <th className="py-2 px-4 text-left">Kayƒ±t Tarihi</th>
                  <th className="py-2 px-4 text-left">ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody>
                {filteredUsers.map((user) => (
                  <tr key={user.id} className="border-b hover:bg-gray-50">
                    <td className="py-2 px-4">
                      <input
                        type="checkbox"
                        checked={selectedUsers.includes(user.id)}
                        onChange={(e) => {
                          if (e.target.checked) {
                            setSelectedUsers([...selectedUsers, user.id]);
                          } else {
                            setSelectedUsers(selectedUsers.filter(id => id !== user.id));
                          }
                        }}
                      />
                    </td>
                    <td className="py-2 px-4">{user.email}</td>
                    <td className="py-2 px-4">{user.displayName || "-"}</td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${user.role === 'admin' ? 'bg-red-100 text-red-800' : user.role === 'moderator' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}`}>
                        {user.role || "user"}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      {user.isBanned ? (
                        <span className="px-2 py-1 rounded text-xs bg-red-100 text-red-800">
                          YASAKLI
                        </span>
                      ) : (
                        <span className="px-2 py-1 rounded text-xs bg-green-100 text-green-800">
                          AKTƒ∞F
                        </span>
                      )}
                    </td>
                    <td className="py-2 px-4">
                      {user.createdAt ? new Date(user.createdAt.seconds * 1000).toLocaleDateString() : "-"}
                    </td>
                    <td className="py-2 px-4 flex gap-2 flex-wrap">
                      {/* Rol Deƒüi≈ütirme */}
                      <select
                        value={user.role || 'user'}
                        onChange={(e) => handleChangeRole(user.id, e.target.value)}
                        disabled={actionLoading === user.id}
                        className="bg-gray-100 hover:bg-gray-200 text-gray-800 px-2 py-1 rounded text-xs disabled:opacity-50 border"
                      >
                        <option value="user">Kullanƒ±cƒ±</option>
                        <option value="moderator">Moderat√∂r</option>
                        <option value="admin">Admin</option>
                      </select>
                      
                                              {/* Ban/Unban - Ge√ßici yasaklama */}
                        <button
                          onClick={() => handleToggleBan(user.id, user.isBanned || false)}
                          disabled={actionLoading === user.id}
                          className={`px-2 py-1 rounded text-xs disabled:opacity-50 ${
                            user.isBanned 
                              ? 'bg-green-500 hover:bg-green-600 text-white' 
                              : 'bg-orange-500 hover:bg-orange-600 text-white'
                          }`}
                          title={user.isBanned ? "Ban kaldƒ±r - Kullanƒ±cƒ± tekrar giri≈ü yapabilir" : "Banla - Kullanƒ±cƒ± ge√ßici olarak yasaklanƒ±r"}
                        >
                          {user.isBanned ? "üîì Ban Kaldƒ±r" : "üö´ Banla"}
                        </button>
                        
                        {/* Rol Deƒüi≈ütirme */}
                        <select
                          value={user.role || 'user'}
                          onChange={(e) => handleChangeRole(user.id, e.target.value)}
                          disabled={actionLoading === user.id}
                          className="bg-blue-100 hover:bg-blue-200 text-blue-800 px-2 py-1 rounded text-xs disabled:opacity-50 border"
                          title="Kullanƒ±cƒ± rol√ºn√º deƒüi≈ütir"
                        >
                          <option value="user">üë§ Kullanƒ±cƒ±</option>
                          <option value="moderator">üõ°Ô∏è Moderat√∂r</option>
                          <option value="admin">üëë Admin</option>
                          <option value="super_admin">üöÄ S√ºper Admin</option>
                        </select>
                        
                        {/* Kalƒ±cƒ± Silme - Dƒ∞KKAT! */}
                        <button
                          onClick={() => {
                            const confirm = window.confirm(
                              `‚ö†Ô∏è Dƒ∞KKAT! Bu i≈ülem geri alƒ±namaz!\n\n` +
                              `"${user.email}" kullanƒ±cƒ±sƒ±nƒ± kalƒ±cƒ± olarak silmek istediƒüinize emin misiniz?\n\n` +
                              `Bu i≈ülem:\n` +
                              `‚Ä¢ Kullanƒ±cƒ± hesabƒ±nƒ± tamamen siler\n` +
                              `‚Ä¢ T√ºm verilerini (ilanlar, notlar, vb.) siler\n` +
                              `‚Ä¢ Geri alƒ±namaz!\n\n` +
                              `Banlama yerine silme yapmak istediƒüinizden emin misiniz?`
                            );
                            if (confirm) {
                              handleDelete(user.id);
                            }
                          }}
                          disabled={actionLoading === user.id}
                          className="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs disabled:opacity-50 font-bold"
                          title="‚ö†Ô∏è KALICI Sƒ∞LME - T√ºm veriler kaybolur!"
                        >
                          üíÄ Kalƒ±cƒ± Sil
                        </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {/* ƒ∞lanlar Tablosu */}
      <div className="bg-white rounded-lg shadow mb-8">
        <div className="p-6 border-b">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-semibold">ƒ∞kinci El ƒ∞lanlarƒ±</h2>
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="ƒ∞lan ara..."
                value={listingSearch}
                onChange={(e) => setListingSearch(e.target.value)}
                className="border rounded px-3 py-1"
              />
              <button
                onClick={() => handleBulkApproveListings()}
                disabled={selectedListings.length === 0 || bulkActionLoading}
                className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
              >
                Onayla ({selectedListings.length})
              </button>
              <button
                onClick={() => handleBulkDeleteListings()}
                disabled={selectedListings.length === 0 || bulkActionLoading}
                className="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
              >
                Sil ({selectedListings.length})
              </button>
            </div>
          </div>
          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead>
                <tr className="bg-gray-50">
                  <th className="py-2 px-4 text-left">
                    <input
                      type="checkbox"
                      checked={selectedListings.length === filteredListings.length && filteredListings.length > 0}
                      onChange={(e) => handleSelectAllListings(e.target.checked)}
                    />
                  </th>
                  <th className="py-2 px-4 text-left">Ba≈ülƒ±k</th>
                  <th className="py-2 px-4 text-left">Kategori</th>
                  <th className="py-2 px-4 text-left">Fiyat</th>
                  <th className="py-2 px-4 text-left">Tarih</th>
                  <th className="py-2 px-4 text-left">Onay Durumu</th>
                  <th className="py-2 px-4 text-left">Premium</th>
                  <th className="py-2 px-4 text-left">ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody>
                {filteredListings.map((listing) => (
                  <tr key={listing.id} className="border-b hover:bg-gray-50">
                    <td className="py-2 px-4">
                      <input
                        type="checkbox"
                        checked={selectedListings.includes(listing.id)}
                        onChange={(e) => {
                          if (e.target.checked) {
                            setSelectedListings([...selectedListings, listing.id]);
                          } else {
                            setSelectedListings(selectedListings.filter(id => id !== listing.id));
                          }
                        }}
                      />
                    </td>
                    <td className="py-2 px-4">{listing.title}</td>
                    <td className="py-2 px-4">{listing.category}</td>
                    <td className="py-2 px-4">{listing.price} TL</td>
                    <td className="py-2 px-4">
                      {listing.createdAt ? new Date(listing.createdAt.seconds * 1000).toLocaleDateString() : "-"}
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${listing.isApproved ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>
                        {listing.isApproved ? 'Onaylƒ±' : 'Onay Bekliyor'}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${listing.isPremium ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'}`}>
                        {listing.isPremium ? 'üëë Premium' : 'Normal'}
                      </span>
                    </td>
                    <td className="py-2 px-4 flex gap-2">
                      <button
                        onClick={() => {
                          // Resim √∂nizleme modalƒ± a√ß
                          const images = listing.images || [listing.image];
                          if (images.length > 0) {
                            alert(`ƒ∞lan: ${listing.title}\nFiyat: ${listing.price} TL\nResim sayƒ±sƒ±: ${images.length}`);
                          }
                        }}
                        className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs"
                      >
                        √ñnizle
                      </button>
                      <a href={`/ikinci-el/${listing.id}`} target="_blank" className="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">G√∂r√ºnt√ºle</a>
                      {!listing.isApproved && (
                        <button
                          onClick={() => handleModerateContent('secondhand', listing.id, 'approve')}
                          disabled={listingActionLoading === listing.id}
                          className="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Onayla
                        </button>
                      )}
                      {listing.isApproved && (
                        <button
                          onClick={() => {
                            const reason = prompt("Reddetme sebebi:");
                            if (reason !== null) {
                              handleModerateContent('secondhand', listing.id, 'reject', reason);
                            }
                          }}
                          disabled={listingActionLoading === listing.id}
                          className="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Reddet
                        </button>
                      )}
                      <button
                        onClick={() => handleTogglePremiumListing(listing.id, listing.isPremium)}
                        disabled={listingActionLoading === listing.id}
                        className={`${listing.isPremium ? 'bg-gray-500 hover:bg-gray-600' : 'bg-yellow-500 hover:bg-yellow-600'} text-white px-2 py-1 rounded text-xs disabled:opacity-50`}
                      >
                        {listing.isPremium ? 'üëë Premium ƒ∞ptal' : 'üëë Premium Yap'}
                      </button>
                      <button
                        onClick={() => handleDeleteListing(listing.id)}
                        disabled={listingActionLoading === listing.id}
                        className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        Sil
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {/* Etkinlikler Tablosu */}
      <div className="bg-white rounded-lg shadow mb-8">
        <div className="p-6 border-b">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-semibold">Etkinlikler ({events.length})</h2>
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="Etkinlik ara..."
                value={eventSearch}
                onChange={(e) => setEventSearch(e.target.value)}
                className="border rounded px-3 py-1"
              />
              <button
                onClick={async () => {
                  console.log('üîÑ Manuel yenileme ba≈ülatƒ±lƒ±yor...');
                  try {
                    const eventsRef = collection(db, "events");
                    const snap = await getDocs(eventsRef);
                    const fetchedEvents = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setEvents(fetchedEvents);
                    console.log('‚úÖ Manuel yenileme tamamlandƒ±, etkinlik sayƒ±sƒ±:', fetchedEvents.length);
                    alert(`Liste yenilendi! ${fetchedEvents.length} etkinlik bulundu.`);
                  } catch (error) {
                    console.error('‚ùå Yenileme hatasƒ±:', error);
                    alert('Yenileme sƒ±rasƒ±nda hata olu≈ütu: ' + error);
                  }
                }}
                className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
              >
                üîÑ Yenile
              </button>
              <button
                onClick={() => handleBulkDeleteEvents()}
                disabled={selectedEvents.length === 0 || bulkActionLoading}
                className="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
              >
                Sil ({selectedEvents.length})
              </button>
            </div>
          </div>

          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead>
                <tr className="bg-gray-50">
                  <th className="py-2 px-4 text-left">
                    <input
                      type="checkbox"
                      checked={selectedEvents.length === filteredEvents.length && filteredEvents.length > 0}
                      onChange={(e) => handleSelectAllEvents(e.target.checked)}
                    />
                  </th>
                  <th className="py-2 px-4 text-left">ID</th>
                  <th className="py-2 px-4 text-left">Ba≈ülƒ±k</th>
                  <th className="py-2 px-4 text-left">Kategori</th>
                  <th className="py-2 px-4 text-left">Tarih</th>
                  <th className="py-2 px-4 text-left">Konum</th>
                  <th className="py-2 px-4 text-left">Durum</th>
                  <th className="py-2 px-4 text-left">Premium</th>
                  <th className="py-2 px-4 text-left">ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody>
                {filteredEvents.map((event) => (
                  <tr key={event.id} className="border-b hover:bg-gray-50">
                    <td className="py-2 px-4">
                      <input
                        type="checkbox"
                        checked={selectedEvents.includes(event.id)}
                        onChange={(e) => {
                          if (e.target.checked) {
                            setSelectedEvents([...selectedEvents, event.id]);
                          } else {
                            setSelectedEvents(selectedEvents.filter(id => id !== event.id));
                          }
                        }}
                      />
                    </td>
                    <td className="py-2 px-4">
                      <span className="text-xs font-mono bg-gray-100 px-2 py-1 rounded">{event.id}</span>
                    </td>
                    <td className="py-2 px-4">{event.title}</td>
                    <td className="py-2 px-4">{event.category}</td>
                    <td className="py-2 px-4">{event.date}</td>
                    <td className="py-2 px-4">{event.location}</td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${
                        event.isApproved === true ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                      }`}>
                        {event.isApproved === true ? 'Onaylƒ±' : 'Onay Bekliyor'}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${event.isPremium ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'}`}>
                        {event.isPremium ? 'üëë Premium' : 'Normal'}
                      </span>
                    </td>
                    <td className="py-2 px-4 flex gap-2">
                      <a href={`/etkinlikler/${event.id}?admin=true`} target="_blank" className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">G√∂r√ºnt√ºle</a>
                      {(event.isApproved !== true) && (
                        <button
                          onClick={() => handleModerateContent('events', event.id, 'approve')}
                          disabled={eventActionLoading === event.id}
                          className="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Onayla
                        </button>
                      )}
                      {(event.isApproved === true) && (
                        <button
                          onClick={() => {
                            const reason = prompt("Reddetme sebebi:");
                            if (reason !== null) {
                              handleModerateContent('events', event.id, 'reject', reason);
                            }
                          }}
                          disabled={eventActionLoading === event.id}
                          className="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Reddet
                        </button>
                      )}
                      <button
                        onClick={() => handleTogglePremiumEvent(event.id, event.isPremium)}
                        disabled={eventActionLoading === event.id}
                        className={`${event.isPremium ? 'bg-gray-500 hover:bg-gray-600' : 'bg-yellow-500 hover:bg-yellow-600'} text-white px-2 py-1 rounded text-xs disabled:opacity-50`}
                      >
                        {event.isPremium ? 'üëë Premium ƒ∞ptal' : 'üëë Premium Yap'}
                      </button>
                      <button
                        onClick={() => handleDeleteEvent(event.id)}
                        disabled={eventActionLoading === event.id}
                        className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        Sil
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {/* Notlar Tablosu */}
      <div className="bg-white rounded-lg shadow mb-8">
        <div className="p-6 border-b">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-semibold">Notlar</h2>
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="Not ara..."
                value={noteSearch}
                onChange={(e) => setNoteSearch(e.target.value)}
                className="border rounded px-3 py-1"
              />
              <button
                onClick={() => handleBulkApproveNotes()}
                disabled={selectedNotes.length === 0 || bulkActionLoading}
                className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
              >
                Onayla ({selectedNotes.length})
              </button>
              <button
                onClick={() => handleBulkDeleteNotes()}
                disabled={selectedNotes.length === 0 || bulkActionLoading}
                className="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
              >
                Sil ({selectedNotes.length})
              </button>
            </div>
          </div>
          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead>
                <tr className="bg-gray-50">
                  <th className="py-2 px-4 text-left">
                    <input
                      type="checkbox"
                      checked={selectedNotes.length === filteredNotes.length && filteredNotes.length > 0}
                      onChange={(e) => handleSelectAllNotes(e.target.checked)}
                    />
                  </th>
                  <th className="py-2 px-4 text-left">Ba≈ülƒ±k</th>
                  <th className="py-2 px-4 text-left">Ders</th>
                  <th className="py-2 px-4 text-left">√úniversite</th>
                  <th className="py-2 px-4 text-left">Sayfa</th>
                  <th className="py-2 px-4 text-left">ƒ∞ndirme</th>
                  <th className="py-2 px-4 text-left">Durum</th>
                  <th className="py-2 px-4 text-left">Tarih</th>
                  <th className="py-2 px-4 text-left">ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody>
                {filteredNotes.map((note) => (
                  <tr key={note.id} className="border-b hover:bg-gray-50">
                    <td className="py-2 px-4">
                      <input
                        type="checkbox"
                        checked={selectedNotes.includes(note.id)}
                        onChange={(e) => {
                          if (e.target.checked) {
                            setSelectedNotes([...selectedNotes, note.id]);
                          } else {
                            setSelectedNotes(selectedNotes.filter(id => id !== note.id));
                          }
                        }}
                      />
                    </td>
                    <td className="py-2 px-4">{note.title}</td>
                    <td className="py-2 px-4">{note.subject}</td>
                    <td className="py-2 px-4">{note.university}</td>
                    <td className="py-2 px-4">
                      <span className="px-2 py-1 rounded text-xs bg-blue-100 text-blue-800">
                        {note.pageCount || 0} sayfa
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      <span className="px-2 py-1 rounded text-xs bg-green-100 text-green-800">
                        {note.downloadCount || 0} indirme
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${
                        note.isApproved ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                      }`}>
                        {note.isApproved ? 'Onaylandƒ±' : 'Onay Bekliyor'}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      {note.createdAt ? new Date(note.createdAt.seconds * 1000).toLocaleDateString() : "-"}
                    </td>
                    <td className="py-2 px-4 flex gap-2">
                      <a href={`/notlar/${note.id}`} target="_blank" className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">G√∂r√ºnt√ºle</a>
                      {!note.isApproved && (
                        <button
                          onClick={() => handleModerateContent('notes', note.id, 'approve')}
                          disabled={noteActionLoading === note.id}
                          className="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Onayla
                        </button>
                      )}
                      {note.isApproved && (
                        <button
                          onClick={() => {
                            const reason = prompt("Reddetme sebebi:");
                            if (reason !== null) {
                              handleModerateContent('notes', note.id, 'reject', reason);
                            }
                          }}
                          disabled={noteActionLoading === note.id}
                          className="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Reddet
                        </button>
                      )}
                      <button
                        onClick={() => handleDeleteNote(note.id)}
                        disabled={noteActionLoading === note.id}
                        className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        Sil
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {/* Ev Arkada≈üƒ± ƒ∞lanlarƒ± Tablosu */}
      <div className="bg-white rounded-lg shadow mb-8">
        <div className="p-6 border-b">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-semibold">Ev Arkada≈üƒ± ƒ∞lanlarƒ±</h2>
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="ƒ∞lan ara..."
                value={roommateSearch}
                onChange={(e) => setRoommateSearch(e.target.value)}
                className="border rounded px-3 py-1"
              />
              <button
                onClick={() => {
                  console.log('üîç DEBUG: T√ºm ev arkada≈üƒ± ilanlarƒ±:', roommates);
                  console.log('üîç DEBUG: Filtrelenmi≈ü ilanlar:', filteredRoommates);
                  alert(`Toplam: ${roommates.length}, Filtrelenmi≈ü: ${filteredRoommates.length}, Onay bekleyen: ${pendingRoommates}`);
                }}
                className="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm"
              >
                Debug
              </button>
              <button
                onClick={() => {
                  console.log('üîÑ Ev arkada≈üƒ± verileri yenileniyor...');
                  setRoommateActionLoading('refresh');
                  setTimeout(() => setRoommateActionLoading(null), 1000);
                }}
                className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
              >
                Yenile
              </button>
              <button
                onClick={() => handleBulkApproveRoommates()}
                disabled={selectedRoommates.length === 0 || bulkActionLoading}
                className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
              >
                Onayla ({selectedRoommates.length})
              </button>
              <button
                onClick={() => handleBulkDeleteRoommates()}
                disabled={selectedRoommates.length === 0 || bulkActionLoading}
                className="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50"
              >
                Sil ({selectedRoommates.length})
              </button>
            </div>
          </div>
          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead>
                <tr className="bg-gray-50">
                  <th className="py-2 px-4 text-left">
                    <input
                      type="checkbox"
                      checked={selectedRoommates.length === filteredRoommates.length && filteredRoommates.length > 0}
                      onChange={(e) => handleSelectAllRoommates(e.target.checked)}
                    />
                  </th>
                  <th className="py-2 px-4 text-left">ID</th>
                  <th className="py-2 px-4 text-left">ƒ∞sim</th>
                  <th className="py-2 px-4 text-left">√úniversite</th>
                  <th className="py-2 px-4 text-left">Konum</th>
                  <th className="py-2 px-4 text-left">Fiyat</th>
                  <th className="py-2 px-4 text-left">Tip</th>
                  <th className="py-2 px-4 text-left">Durum</th>
                  <th className="py-2 px-4 text-left">Premium</th>
                  <th className="py-2 px-4 text-left">Tarih</th>
                  <th className="py-2 px-4 text-left">ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody>
                {filteredRoommates.map((roommate) => (
                  <tr key={roommate.id} className="border-b hover:bg-gray-50">
                    <td className="py-2 px-4">
                      <input
                        type="checkbox"
                        checked={selectedRoommates.includes(roommate.id)}
                        onChange={(e) => {
                          if (e.target.checked) {
                            setSelectedRoommates([...selectedRoommates, roommate.id]);
                          } else {
                            setSelectedRoommates(selectedRoommates.filter(id => id !== roommate.id));
                          }
                        }}
                      />
                    </td>
                    <td className="py-2 px-4 text-xs font-mono">{roommate.id}</td>
                    <td className="py-2 px-4">{roommate.name}</td>
                    <td className="py-2 px-4">{roommate.university}</td>
                    <td className="py-2 px-4">{roommate.location}</td>
                    <td className="py-2 px-4">{roommate.price} {roommate.currency}</td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${
                        roommate.type === 'seeking' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'
                      }`}>
                        {roommate.type === 'seeking' ? 'Ev Arkada≈üƒ± Arƒ±yor' : 'Ev Arƒ±yor'}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${
                        roommate.isApproved ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                      }`}>
                        {roommate.isApproved ? 'Onaylandƒ±' : 'Onay Bekliyor'}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${roommate.isPremium ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'}`}>
                        {roommate.isPremium ? 'üëë Premium' : 'Normal'}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      {roommate.createdAt ? new Date(roommate.createdAt.seconds * 1000).toLocaleDateString() : "-"}
                    </td>
                    <td className="py-2 px-4 flex gap-2">
                      <a href={`/ev-arkadasi/${roommate.id}`} target="_blank" className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">G√∂r√ºnt√ºle</a>
                      {!roommate.isApproved && (
                        <button
                          onClick={() => handleModerateContent('roommates', roommate.id, 'approve')}
                          disabled={roommateActionLoading === roommate.id}
                          className="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Onayla
                        </button>
                      )}
                      {roommate.isApproved && (
                        <button
                          onClick={() => {
                            const reason = prompt("Reddetme sebebi:");
                            if (reason !== null) {
                              handleModerateContent('roommates', roommate.id, 'reject', reason);
                            }
                          }}
                          disabled={roommateActionLoading === roommate.id}
                          className="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                        >
                          Reddet
                        </button>
                      )}
                      <button
                        onClick={() => handleTogglePremiumRoommate(roommate.id, roommate.isPremium)}
                        disabled={roommateActionLoading === roommate.id}
                        className={`${roommate.isPremium ? 'bg-gray-500 hover:bg-gray-600' : 'bg-yellow-500 hover:bg-yellow-600'} text-white px-2 py-1 rounded text-xs disabled:opacity-50`}
                      >
                        {roommate.isPremium ? 'üëë Premium ƒ∞ptal' : 'üëë Premium Yap'}
                      </button>
                      <button
                        onClick={() => handleDeleteRoommate(roommate.id)}
                        disabled={roommateActionLoading === roommate.id}
                        className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        Sil
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
            
            {/* Bo≈ü durum mesajƒ± */}
            {filteredRoommates.length === 0 && (
              <div className="p-6 text-center text-gray-500">
                <div className="text-4xl mb-2">üè†</div>
                <p>Hen√ºz ev arkada≈üƒ± ilanƒ± bulunmuyor.</p>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Erken Eri≈üim Kayƒ±tlarƒ± Tablosu */}
      <div className="bg-white rounded-lg shadow mb-8">
        <div className="p-6 border-b">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-semibold">Erken Eri≈üim Kayƒ±tlarƒ±</h2>
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="E-posta ara..."
                value={earlyAccessSearch}
                onChange={(e) => setEarlyAccessSearch(e.target.value)}
                className="border rounded px-3 py-1"
              />
            </div>
          </div>
          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead>
                <tr className="bg-gray-50">
                  <th className="py-2 px-4 text-left">E-posta</th>
                  <th className="py-2 px-4 text-left">Kayƒ±t Tarihi</th>
                  <th className="py-2 px-4 text-left">Durum</th>
                  <th className="py-2 px-4 text-left">ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody>
                {earlyAccessRegistrations
                  .filter(reg => reg.email.toLowerCase().includes(earlyAccessSearch.toLowerCase()))
                  .map((registration) => {
                    console.log('üîç Admin paneli - Erken eri≈üim kaydƒ± render ediliyor:', registration);
                    return (
                  <tr key={registration.id} className="border-b hover:bg-gray-50">
                    <td className="py-2 px-4">{registration.email}</td>
                    <td className="py-2 px-4">
                      {registration.timestamp ? new Date(registration.timestamp.seconds * 1000).toLocaleDateString() : "-"}
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${registration.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}`}>
                        {registration.status === 'pending' ? 'Bekliyor' : 'Bilgilendirildi'}
                      </span>
                    </td>
                    <td className="py-2 px-4 flex gap-2">
                      <button
                        onClick={async () => {
                          try {
                            await updateDoc(doc(db, "early_access_registrations", registration.id), {
                              status: registration.status === 'pending' ? 'notified' : 'pending'
                            });
                            setEarlyAccessActionLoading(registration.id);
                            setTimeout(() => setEarlyAccessActionLoading(null), 1000);
                          } catch (error) {
                            console.error('Durum g√ºncelleme hatasƒ±:', error);
                          }
                        }}
                        disabled={earlyAccessActionLoading === registration.id}
                        className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        {registration.status === 'pending' ? 'Bilgilendir' : 'Bekliyor Yap'}
                      </button>
                      <button
                        onClick={async () => {
                          try {
                            await deleteDoc(doc(db, "early_access_registrations", registration.id));
                            setEarlyAccessActionLoading(registration.id);
                            setTimeout(() => setEarlyAccessActionLoading(null), 1000);
                          } catch (error) {
                            console.error('Silme hatasƒ±:', error);
                          }
                        }}
                        disabled={earlyAccessActionLoading === registration.id}
                        className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        Sil
                      </button>
                    </td>
                  </tr>
                );
                })}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {/* ƒ∞leti≈üim Mesajlarƒ± Tablosu */}
      <div className="bg-white rounded-lg shadow mb-8">
        <div className="p-6 border-b">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-semibold">ƒ∞leti≈üim Mesajlarƒ±</h2>
            <div className="flex gap-2">
              <input
                type="text"
                placeholder="Mesaj ara..."
                value={contactSearch}
                onChange={(e) => setContactSearch(e.target.value)}
                className="border rounded px-3 py-1"
              />
            </div>
          </div>
          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead>
                <tr className="bg-gray-50">
                  <th className="py-2 px-4 text-left">ƒ∞sim</th>
                  <th className="py-2 px-4 text-left">E-posta</th>
                  <th className="py-2 px-4 text-left">Konu</th>
                  <th className="py-2 px-4 text-left">Mesaj</th>
                  <th className="py-2 px-4 text-left">Tarih</th>
                  <th className="py-2 px-4 text-left">Durum</th>
                  <th className="py-2 px-4 text-left">ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody>
                {contactMessages
                  .filter(msg => 
                    msg.name.toLowerCase().includes(contactSearch.toLowerCase()) ||
                    msg.email.toLowerCase().includes(contactSearch.toLowerCase()) ||
                    msg.subject.toLowerCase().includes(contactSearch.toLowerCase()) ||
                    msg.message.toLowerCase().includes(contactSearch.toLowerCase())
                  )
                  .map((message) => (
                  <tr key={message.id} className="border-b hover:bg-gray-50">
                    <td className="py-2 px-4">{message.name}</td>
                    <td className="py-2 px-4">{message.email}</td>
                    <td className="py-2 px-4">{message.subject}</td>
                    <td className="py-2 px-4">
                      <div className="max-w-xs truncate" title={message.message}>
                        {message.message}
                      </div>
                    </td>
                    <td className="py-2 px-4">
                      {message.timestamp ? new Date(message.timestamp.seconds * 1000).toLocaleDateString() : "-"}
                    </td>
                    <td className="py-2 px-4">
                      <span className={`px-2 py-1 rounded text-xs ${message.status === 'unread' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`}>
                        {message.status === 'unread' ? 'Okunmadƒ±' : 'Okundu'}
                      </span>
                    </td>
                    <td className="py-2 px-4 flex gap-2">
                      <button
                        onClick={async () => {
                          try {
                            await updateDoc(doc(db, "contact_messages", message.id), {
                              status: message.status === 'unread' ? 'read' : 'unread'
                            });
                            setContactActionLoading(message.id);
                            setTimeout(() => setContactActionLoading(null), 1000);
                          } catch (error) {
                            console.error('Durum g√ºncelleme hatasƒ±:', error);
                          }
                        }}
                        disabled={contactActionLoading === message.id}
                        className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        {message.status === 'unread' ? 'Okundu ƒ∞≈üaretle' : 'Okunmadƒ± ƒ∞≈üaretle'}
                      </button>
                      <button
                        onClick={async () => {
                          try {
                            await deleteDoc(doc(db, "contact_messages", message.id));
                            setContactActionLoading(message.id);
                            setTimeout(() => setContactActionLoading(null), 1000);
                          } catch (error) {
                            console.error('Silme hatasƒ±:', error);
                          }
                        }}
                        disabled={contactActionLoading === message.id}
                        className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs disabled:opacity-50"
                      >
                        Sil
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      </div>
      <Footer />
    </div>
  );
} 